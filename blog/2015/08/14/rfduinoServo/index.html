
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Make an RFduino Servo Controller - Michael's Software Blog</title>
  <meta name="author" content="Michael J Carey">

  
  <meta name="description" content="An RFduino is a tiny fingertip sized Arduino that features wireless Bluetooth. An assortment of tiny stackable shields are made available so that you &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://michaeljcarey.github.io/blog/2015/08/14/rfduinoServo/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Michael's Software Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Michael J Carey</a></h1>
  
    <h2>My Life as a Control Freak</h2>
  
</hgroup>


</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="michaeljcarey.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Make an RFduino Servo Controller</h1>
      <br /><p>Author:  <a href="/blog/about/" rel="author">Michael J Carey</a>
      <br />
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-08-14T13:36:02-07:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:36 pm</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://michaeljcarey.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>An RFduino is a tiny fingertip sized Arduino that features wireless Bluetooth.  An assortment of tiny stackable shields are made available so that you can make a number of cool projects. To learn how to set up an RFduino, see <a href="/blog/2015/08/13/rfduinosetup/">Setup Your First RFduino</a>.</p>

<p>I have been wanting to make a simple servo controller project lately and I thought that this little package is the coolest thing because it is tiny, wireless and I can power it with a USB power pack which makes it completely self contained and it will be controlled wirelessly using an Iphone.</p>

<h3>What You Need</h3>

<p>This little project requires the basic wireless RFduino plus their USB and servo shields. The USB shield not only provides the most convenient way to apply power, but also provides a way to download sketches (programs) into the controller.  The Servo shield can control up to four servos.</p>

<p><a href="http://www.rfduino.com/product/rfd22102-rfduino-dip/index.html"><img src="http://www.rfduino.com/wp-content/uploads/2014/03/RFD22102.Prospective.Top_.png" width="250" height="250" title="RFduino RFD22102" ></a>
<a href="http://www.rfduino.com/product/rfd22121-usb-shield-for-rfduino/index.html"><img src="http://www.rfduino.com/wp-content/uploads/2014/03/RFD22121.Prospective.Top_.png" width="250" height="250" title="RFduino RFD22121" ></a>
<a href="http://www.rfduino.com/product/rfd22123-servo-shield-for-rfduino/index.html"><img src="http://www.rfduino.com/wp-content/uploads/2014/03/RFD22123.Prospective.Top_.png" width="250" height="250" title="RFduino RFD22102" ></a></p>

<p>I also need some servos to drive and I found a neat little <a href="https://www.adafruit.com/products/1967">Mini Pan-Tilt Kit</a> for under $20 from Adafruit.  You can use any servos that you wish in your project.  To power it all, I decided to use a USB Power Bank as a battery. I happened to find one that suits my need in Lumsing. I wanted to keep my cabling simple and off the shelf so I got a usb to barrel jack cable, and a <a href"http://www.adafruit.com/products/368>Female DC Power Adapter</a> which I also picked up from Adafruit.</p>

<p><img src="/images/custom/rfduino/rfDuServoParts25.jpg" title="Parts for my RFduino Servo System" ></p>

<h3>Program the RFduino</h3>

<p>Connect the RFduino and USB shield together and plug into your computer.
<img src="/images/custom/rfduino/rfDuSetup25.jpg" title="Programming the RFduino" >
Open the Arduino IDE.  Follow the <a href="">RFduino Setup</a> post if you don&rsquo;t know how to do this.  Open the sketch from File/Examples/RFduinoBLE/Servo in the IDE.
Which basically looks like this:</p>

<figure class='code'><figcaption><span>RFduino Servo Sketch</span><a href='https://michaeljcarey.github.io'>Source Article</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#include &lt;Servo.h&gt;</span>
</span><span class='line'><span class="c1">#include &lt;RFduinoBLE.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Servo</span> <span class="n">s1</span><span class="p">;</span>
</span><span class='line'><span class="no">Servo</span> <span class="n">s2</span><span class="p">;</span>
</span><span class='line'><span class="no">Servo</span> <span class="n">s3</span><span class="p">;</span>
</span><span class='line'><span class="no">Servo</span> <span class="n">s4</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">s1</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">s2</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>  <span class="n">s3</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span><span class='line'>  <span class="n">s4</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span class='line'>  <span class="no">RFduinoBLE</span><span class="o">.</span><span class="n">advertisementInterval</span> <span class="o">=</span> <span class="mi">675</span><span class="p">;</span>
</span><span class='line'>  <span class="no">RFduinoBLE</span><span class="o">.</span><span class="n">advertisementData</span> <span class="o">=</span> <span class="s2">&quot;-servo&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="no">RFduinoBLE</span><span class="o">.</span><span class="n">begin</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">void</span> <span class="kp">loop</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="sr">//</span> <span class="no">RFduino_ULPDelay</span><span class="p">(</span><span class="no">INFINITE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">void</span> <span class="no">RFduinoBLE_onReceive</span><span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">int</span> <span class="n">len</span><span class="p">){</span>
</span><span class='line'>  <span class="n">int</span> <span class="n">servo</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
</span><span class='line'>  <span class="n">int</span> <span class="n">degree</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">bitRead</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span class='line'>    <span class="n">s1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">degree</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">bitRead</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span class='line'>    <span class="n">s2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">degree</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">bitRead</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span class='line'>    <span class="n">s3</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">degree</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">bitRead</span><span class="p">(</span><span class="n">servo</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span class='line'>    <span class="n">s4</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">degree</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And download the the servo sketch into the Arduino.</p>

<h3>Some Assembly Required</h3>

<p>Strip two small pieces of wire and connect the +v(s) and gnds on the terminal blocks of the servo shield to the ones on the DC Power Adapter.</p>

<p><img src="/images/custom/rfduino/rfDuServoConn25.jpg" title="The Servo Shield and DC Connector" ></p>

<p>Connect the Servo Wires to the RFduino Servo Shield and then connect the Servo Shield to the RFduino.</p>

<ul>
<li> Brown is Gnd</li>
<li> Red is +5v</li>
<li> Orange is Signal</li>
</ul>


<p><img src="/images/custom/rfduino/rfDuAssy25.jpg" title="Connect the Servos" ></p>

<h3>Connect Power</h3>

<p>Plug both the RFduino and Servo Shield power to the Power Bank.</p>

<p><img src="/images/custom/rfduino/rfDuServoComp25.jpg" title="Connections for My RFduino Servo System" ></p>

<h3>Get the Iphone App</h3>

<p>Go to the App Store on your Iphone and search for RFduino.
Find the Servo app and install it.
Once installed, turn on the Power Bank, then open the Iphone Servo App. The app should discover the RFduino and display it in the app. Click on the found RFduino and it should open a control panel.</p>

<p><img src="/images/custom/rfduino/rfDuFound2.png" width="350" title="System" >
<img src="/images/custom/rfduino/rfDuServoApp.png" width="350" title="System" ></p>

<p>You should be able to select servo channels and then move the slider and your new Servo System should respond.</p>

<p>My servo system is acting a little sick as you can see from the YouTube video.  What is going on?</p>

<div class="ratio-4-3 embed-video-container" onclick="var myAnchor = document.getElementById('Z4ERE7K_RbI');var tmpDiv = document.createElement('div');tmpDiv.innerHTML = '&lt;iframe style=&quot;vertical-align:top;width:100%;height:100%;position:absolute;&quot; src=&quot;http://www.youtube.com/embed/Z4ERE7K_RbI?autoplay=1&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;';myAnchor.parentNode.replaceChild(tmpDiv.firstChild, myAnchor);return false;" title="click here to play">
<a class="youtube-lazy-link" style="width:100%;height:100%;background:#000 url(http://i2.ytimg.com/vi/Z4ERE7K_RbI/0.jpg) center center no-repeat;background-size:contain;position:absolute" href="http://www.youtube.com/watch?v=Z4ERE7K_RbI" id="Z4ERE7K_RbI" onclick="return false;">
<div class="youtube-lazy-link-div"></div>
<div class="youtube-lazy-link-info">RFduino Servo System is Spastic</div>
</a>
<div class="video-info" >An RFduino Servo System acting a little spastic.
https://michaeljcarey.github.io</div>
</div>


<p><br/>
Ok, after a bit of digging around, I discovered that although the RFduino BLE and the Servo shield both work well by themselves, they do not work well together.  You see, PWM waveforms are generated by two counters.  One for pulse width and the other for pulse frequency.  In this implementation, the counters used are not actually on the servo shield but internal to the RFduino itself.  You can see from the RFduino Servo Shield Schematic that there are no counters or PWM generator but only a quad amplifier.</p>

<iframe src="http://docs.google.com/gview?url=http://www.rfduino.com/wp-content/uploads/2014/03/rfd22123_r403_b001_sch.pdf&embedded=true" 
style="width:800px; height:550px;" frameborder="0"></iframe>


<p>When the BLE is used, the interrupts somehow corrupt the counters intended for the PWM signal which causes a great deal of unacceptable jitter.  This is something the RFduino folks should fix, but in lieu of that happening, the best solution is to get a third party servo shield with its own PWM generator i.e. its own counters.  In that way, the controller would only need to write two registers (width, period) per servo.  Adafruit provides such a board which I have and will soon implement, but its out of scope for this post.</p>

<p>*Note:  Another possible solution is to use the RFduino and servo shield without the BLE, but then I would lose my wireless capability, which is my sole reason for using the RFduino.</p>

<h3>Conclusion</h3>

<p>This post shows you how to connect an Iphone to and RFduino and servo shield.  I love how this project is so self contained.  You can easily imagine how the parts can easily fit into a robotic system which is not tethered to any stationary devices for power or control.  Although this project proved to be flawed, if an improved servo shield was used, the project would be quite successful.  Maybe I will do this and update this writeup in the future, but for now&hellip;
On to my next robot project.</p>

<p>Do cool things.</p>

<p><meta itemprop="name" content="Make an RFduino Servo Controller" />
<meta itemprop="image" content="https://michaeljcarey.github.io/images/custom/rfduino/rfDuSetup25.jpg" />
<meta itemprop="description" content="I have been wanting to make a simple servo controller project lately and I thought that this little package is the coolest thing." /></p>

<p><meta name="description" content="I have been wanting to make a simple servo controller project lately and I thought that this little package is the coolest thing" />
<meta name="author" content="Michael J Carey" /></p>

<!-- 
<meta property="article:author" content="[ GOOGLE+ AUTHOR URL ]" />

-->


<p><meta property="article:published_time" content="2015-08-14 13:36:02 -0700" />
<meta property="article:section" content="Arduino" /></p>

<p><meta property="og:title" content="Make an RFduino Servo Controller" />
<meta property="og:type" content="article" />
<meta property="og:description" content="I have been wanting to make a simple servo controller project lately and I thought that this little package is the coolest thing" />
<meta property="og:image" content="https://michaeljcarey.github.io/images/custom/rfduino/rfDuSetup25.jpg" />
<meta property="og:url" content="https://michaeljcarey.github.io/blog/2015/08/14/rfduinoServo/" />
<meta property="og:site_name" content="michaeljcarey.github.io" /></p>

<p><meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Make an RFduino Servo Controller">
<meta name="twitter:description" content="I have been wanting to make a simple servo controller project lately and I thought that this little package is the coolest thing">
<meta name="twitter:image" content="https://michaeljcarey.github.io/images/custom/rfduino/rfDuSetup25.jpg">
<meta name="twitter:url" content="https://michaeljcarey.github.io/blog/2015/08/14/rfduinoServo/"></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Michael J Carey</span></span>

      




<time class='entry-date' datetime='2015-08-14T13:36:02-07:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:36 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/arduino/'>arduino</a>, <a class='category' href='/blog/categories/embedded/'>embedded</a>
  
</span>


    </p>
    
      <div class="sharing">
  
    <a href="//twitter.com/share" class="twitter-share-button" data-url="http://michaeljcarey.github.io/blog/2015/08/14/rfduinoServo/" data-via="" data-counturl="http://michaeljcarey.github.io/blog/2015/08/14/rfduinoServo/" >Tweet</a>
  

  

  
    <script src="//platform.linkedin.com/in.js" type="text/javascript">
      lang: en_US
    </script>
    <script type="IN/Share" data-url="http://michaeljcarey.github.io/blog/2015/08/14/rfduinoServo/" data-counter="right"></script>
  

  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/08/13/rfduinosetup/" title="Previous Post: Setup Your first RFduino">&laquo; Setup Your first RFduino</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <a href="/blog/about/"><img src="/images/custom/bwMaggieMe50.bmp"></a>
  <h1><a href="/blog/about/">Michael J Carey</a></h1>
  <p>Software Developer</p>
</a></section>


<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/08/14/rfduinoServo/">Make an RFduino Servo Controller</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/13/rfduinosetup/">Setup Your first RFduino</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/12/blogbasics3/">Blogging Basics III, Make Your Octopress Blog Active with Comments, Analytics and Product Links</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/06/startingmyblog2howtowriteapost/">Blogging Basics II, How to Configure and Edit Your Blog Site in Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/05/myfirstpost/">Blogging Basics I, How to Create a Post on Your Octopress Blog</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/arduino'>arduino (2)</a></li><li><a href='/blog/categories/blog'>blog (3)</a></li><li><a href='/blog/categories/embedded'>embedded (2)</a></li><li><a href='/blog/categories/howto'>howto (3)</a></li><li><a href='/blog/categories/software'>software (1)</a></li></ul>
</section>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- mjcResponsiveAd -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3685467552635186"
     data-ad-slot="7259757951"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Michael J Carey -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'michaeljcareygithubio';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-66060669-1']);
    _gaq.push(['_setDomainName','github.io']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>





</body>
</html>
